{"ast":null,"code":"import _defineProperty from\"/Users/lauraschultz/Documents/projects/yelp-restaurant-chooser/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";import _objectSpread from\"/Users/lauraschultz/Documents/projects/yelp-restaurant-chooser/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _slicedToArray from\"/Users/lauraschultz/Documents/projects/yelp-restaurant-chooser/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{faBinoculars,faCircleNotch,faDoorOpen,faSearch,faUtensils}from\"@fortawesome/free-solid-svg-icons\";import{FontAwesomeIcon}from\"@fortawesome/react-fontawesome\";import React,{useCallback,useContext,useEffect,useState}from\"react\";import Media from\"react-media\";import{Link,NavLink,Redirect,Route,Switch,useHistory}from\"react-router-dom\";import Logo from\"../assets/chew_logo.svg\";import Display from\"../Display\";import AppFooter from\"../AppFooter\";import ModalContainer from\"../ModalContainer\";import Search from\"../Search\";import ShareSessionModal from\"../ShareSessionModal\";import socket from\"../socket\";import Toast from\"../Toast\";import{UserContext,UserContextConsumer}from\"../UserDataContext\";import{UserNameModal}from\"../UserNameModal\";var AppTemplate=function AppTemplate(){var _useState=useState({}),_useState2=_slicedToArray(_useState,2),addedRestaurants=_useState2[0],setAddedRestaurants=_useState2[1];var _useContext=useContext(UserContext),sessionId=_useContext.sessionId,setSessionId=_useContext.setSessionId,userId=_useContext.userId,setUserId=_useContext.setUserId,setUserState=_useContext.setUserState,location=_useContext.location,setLocation=_useContext.setLocation,creatorName=_useContext.creatorName,setCreatorName=_useContext.setCreatorName,setPreviousVotes=_useContext.setPreviousVotes;var _useState3=useState({}),_useState4=_slicedToArray(_useState3,2),isAdded=_useState4[0],setIsAdded=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),loaded=_useState6[0],setLoaded=_useState6[1];var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),showVotingToast=_useState8[0],setShowVotingToast=_useState8[1];var _useState9=useState(false),_useState10=_slicedToArray(_useState9,2),showShareSessionModal=_useState10[0],setShowShareSessionModal=_useState10[1];var _useState11=useState({}),_useState12=_slicedToArray(_useState11,2),searchFormState=_useState12[0],setSearchFormState=_useState12[1];var history=useHistory();useEffect(function(){socket.subscribeToRestaurantAdded(function(newRestaurant){console.log(\"recieving an added restaurant.\");setAddedRestaurants(function(r){return _objectSpread(_objectSpread({},r),{},_defineProperty({},newRestaurant.business.id,newRestaurant));});});socket.subscribeToVoteAdded(function(params){setAddedRestaurants(function(r){return _objectSpread(_objectSpread({},r),{},_defineProperty({},params.restaurantId,_objectSpread(_objectSpread({},r[params.restaurantId]),{},{votes:params.votes})));});});return function(){socket.unSubscribeToRestaurantAdded();socket.unSubscribeToVoteAdded();};},[]);var voteOnRestaurant=function voteOnRestaurant(restaurantId,voteNum){return socket.addVote(sessionId,userId,restaurantId,voteNum);};var updateSearchFormState=useCallback(function(s){return setSearchFormState(function(old){return _objectSpread(_objectSpread({},old),s);});},[setSearchFormState]);var search=/*#__PURE__*/React.createElement(\"div\",{className:\"flex-1 pt-4\"},/*#__PURE__*/React.createElement(Search,{voteOnRestaurant:voteOnRestaurant,isAdded:isAdded,sessionId:sessionId,location:location,creatorName:creatorName,searchFormState:searchFormState,updateSearchFormState:updateSearchFormState}));var display=/*#__PURE__*/React.createElement(\"div\",{className:\"flex-1 pt-4\"},/*#__PURE__*/React.createElement(Display,{voteOnRestaurant:voteOnRestaurant,addedRestaurants:addedRestaurants}));useEffect(function(){var newIsAdded={};Object.keys(addedRestaurants).forEach(function(restId){return newIsAdded[restId]=true;});setIsAdded(newIsAdded);},[addedRestaurants]);useEffect(function(){var _window$history,_window$history$state;if((_window$history=window.history)===null||_window$history===void 0?void 0:(_window$history$state=_window$history.state)===null||_window$history$state===void 0?void 0:_window$history$state.fromLogin){console.log(\"REDIRECTED FROM LOGIN\");setShowShareSessionModal(true);setLoaded(true);// history.replace(history.location, {fromLogin:false})\n// appLoc.state = {fromLogin:false}\nwindow.history.replaceState({fromLogin:false},\"\");}else if(sessionId!==\"\"){socket.tryJoinSession({sessionId:sessionId,userId:userId},function(response){console.log(\"response from tryJoinSession is \".concat(JSON.stringify(response)));if(response.success){setShowVotingToast(false);setSessionId(sessionId);setUserId(response.userId);setUserState(response.previouslyAuthenticated?\"canVote\":\"canView\");setLocation(response.location);setCreatorName(response.creatorName);setPreviousVotes(response.previousVotes);setAddedRestaurants(response.restaurants||{});setLoaded(true);}else{history.push(\"/404\");console.log(\"recieved failure from server\");}});}},[sessionId,history,setCreatorName,setLocation,setPreviousVotes,setSessionId,setUserId,setUserState,userId]);//sessionId\nreturn/*#__PURE__*/React.createElement(React.Fragment,null,showShareSessionModal&&/*#__PURE__*/React.createElement(ModalContainer,{shadow:true},/*#__PURE__*/React.createElement(ShareSessionModal,{escape:function escape(){return setShowShareSessionModal(false);}})),!loaded&&/*#__PURE__*/React.createElement(ModalContainer,{shadow:false},/*#__PURE__*/React.createElement(FontAwesomeIcon,{icon:faCircleNotch,size:\"5x\",className:\"animate-spin text-theme-yellow block\"})),/*#__PURE__*/React.createElement(Toast,{show:showVotingToast},/*#__PURE__*/React.createElement(\"div\",{className:\"p-2 pt-1 md:p-3 md:pt-2 bg-gray-100 flex items-center rounded-md border\"},/*#__PURE__*/React.createElement(FontAwesomeIcon,{icon:faBinoculars,className:\"flex-initial text-gray-800 p-1 pb-0\",size:\"3x\"}),/*#__PURE__*/React.createElement(\"div\",{className:\"flex-1 pl-3\"},/*#__PURE__*/React.createElement(\"div\",{className:\"text-md font-bold border-b border-gray-400 px-1\"},\"Currently in view-only mode.\"),/*#__PURE__*/React.createElement(\"div\",{className:\"text-gray-700 leading-tight mt-1 px-1\"},/*#__PURE__*/React.createElement(\"span\",{className:\"border-b-2 border-theme-blue hover:text-theme-blue cursor-pointer\",onClick:function onClick(){setShowVotingToast(false);}},\"Join the session\"),\" \",\"to add restaurants and vote\")))),/*#__PURE__*/React.createElement(UserContextConsumer,null,function(context){return/*#__PURE__*/React.createElement(React.Fragment,null,loaded&&context.userState!==\"canVote\"&&!showVotingToast&&/*#__PURE__*/React.createElement(ModalContainer,{shadow:true},/*#__PURE__*/React.createElement(UserNameModal,{escape:function escape(){return setShowVotingToast(true);}})),/*#__PURE__*/React.createElement(\"header\",{className:\"bg-theme-red text-white shadow \"},/*#__PURE__*/React.createElement(\"nav\",{className:\"flex justify-between p-1 lg:py-2 lg:px-4\"},/*#__PURE__*/React.createElement(Link,{to:\"/getStarted\"},/*#__PURE__*/React.createElement(\"img\",{className:\"text-white inline-block w-32 lg:w-38 flex-initial\",src:Logo,alt:\"chew logo\"})),/*#__PURE__*/React.createElement(Link,{to:\"/getStarted\",className:\"inline-block flex-initial self-center text-sm\"},\"leave this group \",/*#__PURE__*/React.createElement(FontAwesomeIcon,{icon:faDoorOpen}))),/*#__PURE__*/React.createElement(\"div\",{className:\"md:hidden uppercase font-bold tracking-wide py-1 text-sm bg-theme-dark-red\"},/*#__PURE__*/React.createElement(NavLink,{to:\"/ID/\".concat(context.sessionId),exact:true,className:\"p-1 m-1\",activeClassName:\"border-b-2 border-white\"},/*#__PURE__*/React.createElement(FontAwesomeIcon,{icon:faUtensils,size:\"sm\",className:\"mr-2\"}),\"view restaurants\"),/*#__PURE__*/React.createElement(NavLink,{to:\"/ID/\".concat(context.sessionId,\"/search\"),exact:true,className:\"p-1 m-1\",activeClassName:\"border-b-2 border-white\"},/*#__PURE__*/React.createElement(FontAwesomeIcon,{icon:faSearch,size:\"sm\",className:\"mr-2\"}),\"search\"))),/*#__PURE__*/React.createElement(\"main\",{className:\"flex-grow\"},/*#__PURE__*/React.createElement(Media,{query:\"(min-width: 768px)\",render:function render(){return/*#__PURE__*/React.createElement(Switch,null,/*#__PURE__*/React.createElement(Route,{path:\"/ID/:sessionId\",exact:true,render:function render(){return/*#__PURE__*/React.createElement(\"div\",{className:\"flex justify-around px-1\"},display,\" \",search);}}),/*#__PURE__*/React.createElement(Route,{path:\"/\",render:function render(){return/*#__PURE__*/React.createElement(Redirect,{to:\"/ID/\".concat(context.sessionId)});}}));}}),/*#__PURE__*/React.createElement(Media,{query:\"(max-width: 767px)\",render:function render(){return/*#__PURE__*/React.createElement(Route,{path:\"/ID/:sessionId\",render:function render(_ref){var location=_ref.location;return/*#__PURE__*/ (// <div className=\"w-screen overflow-x-hidden\">\n//   <div\n//     className={\"whitespace-no-wrap transition-spacing \" + (location.pathname.search(\"search\") > -1 ? '-ml-screen': 'm-0')}\n//     // style={\n//     //   location.pathname.search(\"search\") > -1\n//     //     ? { marginLeft: \"-100vw\" }\n//     //     : { marginLeft: \"0\" }\n//     // }\n//   >\n//     <div className=\"w-screen inline-block\">{display}</div>\n//     <div className=\"w-screen inline-block\">{search}</div>\n//   </div>\n// </div>\nReact.createElement(Switch,null,/*#__PURE__*/React.createElement(Route,{path:\"/ID/:sessionId\",exact:true,render:function render(){return display;}}),/*#__PURE__*/React.createElement(Route,{path:\"/ID/:sessionId/search\",exact:true,render:function render(){return search;}})));}});}})),/*#__PURE__*/React.createElement(AppFooter,null));}));};export default AppTemplate;","map":{"version":3,"sources":["/Users/lauraschultz/Documents/projects/yelp-restaurant-chooser/client/src/Templates/AppTemplate.tsx"],"names":["faBinoculars","faCircleNotch","faDoorOpen","faSearch","faUtensils","FontAwesomeIcon","React","useCallback","useContext","useEffect","useState","Media","Link","NavLink","Redirect","Route","Switch","useHistory","Display","AppFooter","ModalContainer","Search","ShareSessionModal","socket","Toast","UserContext","UserContextConsumer","UserNameModal","AppTemplate","addedRestaurants","setAddedRestaurants","sessionId","setSessionId","userId","setUserId","setUserState","location","setLocation","creatorName","setCreatorName","setPreviousVotes","isAdded","setIsAdded","loaded","setLoaded","showVotingToast","setShowVotingToast","showShareSessionModal","setShowShareSessionModal","searchFormState","setSearchFormState","history","subscribeToRestaurantAdded","newRestaurant","console","log","r","business","id","subscribeToVoteAdded","params","restaurantId","votes","unSubscribeToRestaurantAdded","unSubscribeToVoteAdded","voteOnRestaurant","voteNum","addVote","updateSearchFormState","s","old","search","display","newIsAdded","Object","keys","forEach","restId","window","state","fromLogin","replaceState","tryJoinSession","response","JSON","stringify","success","previouslyAuthenticated","previousVotes","restaurants","push","context","userState","Logo"],"mappings":"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","sourcesContent":["import {\n  faBinoculars,\n  faCircleNotch,\n  faDoorOpen,\n  faSearch,\n  faUtensils,\n} from \"@fortawesome/free-solid-svg-icons\";\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\";\nimport React, {\n  ReactFragment,\n  useCallback,\n  useContext,\n  useEffect,\n  useState,\n} from \"react\";\nimport Media from \"react-media\";\nimport {\n  Link,\n  NavLink,\n  Redirect,\n  Route,\n  Switch,\n  useHistory,\n} from \"react-router-dom\";\nimport { Business, BusinessWithVotes } from \"../../../shared/types\";\nimport Logo from \"../assets/chew_logo.svg\";\nimport Display from \"../Display\";\nimport AppFooter from \"../AppFooter\";\nimport ModalContainer from \"../ModalContainer\";\nimport Search from \"../Search\";\nimport ShareSessionModal from \"../ShareSessionModal\";\nimport socket from \"../socket\";\nimport Toast from \"../Toast\";\nimport { UserContext, UserContextConsumer } from \"../UserDataContext\";\nimport { UserNameModal } from \"../UserNameModal\";\n\nexport interface SearchFormState {\n  search: string;\n  filter: FilterForm;\n  results: Business[];\n}\n\nexport interface FilterForm {\n  openDate: \"any\" | \"today\";\n  openNow: boolean;\n  prices: (number | undefined)[];\n  services: {\n    pickup: boolean;\n    delivery: boolean;\n    restaurant_reservation: boolean;\n  };\n}\n\nconst AppTemplate: React.FC = () => {\n  let [addedRestaurants, setAddedRestaurants] = useState<{\n    [id: string]: BusinessWithVotes;\n  }>({});\n  let {\n    sessionId,\n    setSessionId,\n    userId,\n    setUserId,\n    setUserState,\n    location,\n    setLocation,\n    creatorName,\n    setCreatorName,\n    setPreviousVotes,\n  } = useContext(UserContext);\n  let [isAdded, setIsAdded] = useState<{ [id: string]: boolean }>({});\n  let [loaded, setLoaded] = useState(false);\n  let [showVotingToast, setShowVotingToast] = useState(false);\n  let [showShareSessionModal, setShowShareSessionModal] = useState(false);\n  let [searchFormState, setSearchFormState] = useState<\n    Partial<SearchFormState>\n  >({});\n  let history = useHistory();\n\n  useEffect(() => {\n    socket.subscribeToRestaurantAdded((newRestaurant: BusinessWithVotes) => {\n      console.log(\"recieving an added restaurant.\");\n      setAddedRestaurants((r) => ({\n        ...r,\n        [newRestaurant.business.id]: newRestaurant,\n      }));\n    });\n\n    socket.subscribeToVoteAdded(\n      (params: { restaurantId: string; votes: string[] }) => {\n        setAddedRestaurants((r) => ({\n          ...r,\n          [params.restaurantId]: {\n            ...r[params.restaurantId],\n            votes: params.votes,\n          },\n        }));\n      }\n    );\n    return () => {\n      socket.unSubscribeToRestaurantAdded();\n      socket.unSubscribeToVoteAdded();\n    };\n  }, []);\n\n  const voteOnRestaurant = (restaurantId: string, voteNum: number) =>\n    socket.addVote(sessionId, userId, restaurantId, voteNum);\n\n  const updateSearchFormState = useCallback(\n    (s: Partial<SearchFormState>) =>\n      setSearchFormState((old) => ({ ...old, ...s })),\n    [setSearchFormState]\n  );\n\n  let search: ReactFragment = (\n    <div className=\"flex-1 pt-4\">\n      <Search\n        voteOnRestaurant={voteOnRestaurant}\n        isAdded={isAdded}\n        sessionId={sessionId}\n        location={location}\n        creatorName={creatorName}\n        searchFormState={searchFormState}\n        updateSearchFormState={updateSearchFormState}\n      />\n    </div>\n  );\n\n  let display: ReactFragment = (\n    <div className=\"flex-1 pt-4\">\n      <Display\n        voteOnRestaurant={voteOnRestaurant}\n        addedRestaurants={addedRestaurants}\n      />\n    </div>\n  );\n\n  useEffect(() => {\n    const newIsAdded: { [id: string]: boolean } = {};\n    Object.keys(addedRestaurants).forEach(\n      (restId) => (newIsAdded[restId] = true)\n    );\n    setIsAdded(newIsAdded);\n  }, [addedRestaurants]);\n\n  useEffect(() => {\n    if (window.history?.state?.fromLogin) {\n      console.log(`REDIRECTED FROM LOGIN`);\n      setShowShareSessionModal(true);\n      setLoaded(true);\n\n      // history.replace(history.location, {fromLogin:false})\n      // appLoc.state = {fromLogin:false}\n\n      window.history.replaceState({ fromLogin: false }, \"\");\n    } else if (sessionId !== \"\") {\n      socket.tryJoinSession({ sessionId, userId }, (response) => {\n        console.log(\n          `response from tryJoinSession is ${JSON.stringify(response)}`\n        );\n        if (response.success) {\n          setShowVotingToast(false);\n          setSessionId(sessionId);\n          setUserId(response.userId);\n          setUserState(\n            response.previouslyAuthenticated ? \"canVote\" : \"canView\"\n          );\n          setLocation(response.location);\n          setCreatorName(response.creatorName);\n          setPreviousVotes(response.previousVotes);\n          setAddedRestaurants(response.restaurants || {});\n          setLoaded(true);\n        } else {\n          history.push(\"/404\");\n          console.log(\"recieved failure from server\");\n        }\n      });\n    }\n  }, [sessionId, history, setCreatorName, setLocation, setPreviousVotes, setSessionId, setUserId, setUserState, userId]); //sessionId\n\n  return (\n    <>\n      {showShareSessionModal && (\n        <ModalContainer shadow={true}>\n          <ShareSessionModal escape={() => setShowShareSessionModal(false)} />\n        </ModalContainer>\n      )}\n      {!loaded && (\n        <ModalContainer shadow={false}>\n          <FontAwesomeIcon\n            icon={faCircleNotch}\n            size=\"5x\"\n            className=\"animate-spin text-theme-yellow block\"\n          />\n        </ModalContainer>\n      )}\n      <Toast show={showVotingToast}>\n        <div className=\"p-2 pt-1 md:p-3 md:pt-2 bg-gray-100 flex items-center rounded-md border\">\n          <FontAwesomeIcon\n            icon={faBinoculars}\n            className=\"flex-initial text-gray-800 p-1 pb-0\"\n            size=\"3x\"\n          />\n          <div className=\"flex-1 pl-3\">\n            <div className=\"text-md font-bold border-b border-gray-400 px-1\">\n              Currently in view-only mode.\n            </div>\n            <div className=\"text-gray-700 leading-tight mt-1 px-1\">\n              <span\n                className=\"border-b-2 border-theme-blue hover:text-theme-blue cursor-pointer\"\n                onClick={() => {\n                  setShowVotingToast(false);\n                }}\n              >\n                Join the session\n              </span>{\" \"}\n              to add restaurants and vote\n            </div>\n          </div>\n        </div>\n      </Toast>\n      <UserContextConsumer>\n        {(context) => (\n          <>\n            {loaded && context.userState !== \"canVote\" && !showVotingToast && (\n              <ModalContainer shadow={true}>\n                <UserNameModal escape={() => setShowVotingToast(true)} />\n              </ModalContainer>\n            )}\n            <header className=\"bg-theme-red text-white shadow \">\n              <nav className=\"flex justify-between p-1 lg:py-2 lg:px-4\">\n                <Link to=\"/getStarted\">\n                  <img\n                    className=\"text-white inline-block w-32 lg:w-38 flex-initial\"\n                    src={Logo}\n                    alt=\"chew logo\"\n                  />\n                </Link>\n                <Link\n                  to=\"/getStarted\"\n                  className=\"inline-block flex-initial self-center text-sm\"\n                >\n                  leave this group <FontAwesomeIcon icon={faDoorOpen} />\n                </Link>\n              </nav>\n              <div className=\"md:hidden uppercase font-bold tracking-wide py-1 text-sm bg-theme-dark-red\">\n                <NavLink\n                  to={`/ID/${context.sessionId}`}\n                  exact={true}\n                  className=\"p-1 m-1\"\n                  activeClassName=\"border-b-2 border-white\"\n                >\n                  <FontAwesomeIcon\n                    icon={faUtensils}\n                    size=\"sm\"\n                    className=\"mr-2\"\n                  />\n                  view restaurants\n                </NavLink>\n                <NavLink\n                  to={`/ID/${context.sessionId}/search`}\n                  exact={true}\n                  className=\"p-1 m-1\"\n                  activeClassName=\"border-b-2 border-white\"\n                >\n                  <FontAwesomeIcon icon={faSearch} size=\"sm\" className=\"mr-2\" />\n                  search\n                </NavLink>\n              </div>\n            </header>\n            <main className=\"flex-grow\">\n              {/* LARGE DISPLAYS */}\n              <Media\n                query=\"(min-width: 768px)\"\n                render={() => (\n                  <Switch>\n                    <Route\n                      path=\"/ID/:sessionId\"\n                      exact\n                      render={() => (\n                        <div className=\"flex justify-around px-1\">\n                          {display} {search}\n                        </div>\n                      )}\n                    />\n                    <Route\n                      path=\"/\"\n                      render={() => (\n                        <Redirect to={`/ID/${context.sessionId}`} />\n                      )}\n                    />\n                  </Switch>\n                )}\n              />\n\n              {/* SMALL DISPLAYS */}\n              <Media\n                query=\"(max-width: 767px)\"\n                render={() => (\n                  <Route\n                    path=\"/ID/:sessionId\"\n                    render={({ location }) => (\n                      // <div className=\"w-screen overflow-x-hidden\">\n                      //   <div\n                      //     className={\"whitespace-no-wrap transition-spacing \" + (location.pathname.search(\"search\") > -1 ? '-ml-screen': 'm-0')}\n                      //     // style={\n                      //     //   location.pathname.search(\"search\") > -1\n                      //     //     ? { marginLeft: \"-100vw\" }\n                      //     //     : { marginLeft: \"0\" }\n                      //     // }\n                      //   >\n                      //     <div className=\"w-screen inline-block\">{display}</div>\n                      //     <div className=\"w-screen inline-block\">{search}</div>\n                      //   </div>\n                      // </div>\n\n                      <Switch>\n                        <Route\n                          path=\"/ID/:sessionId\"\n                          exact\n                          render={() => display}\n                        />\n                        <Route\n                          path=\"/ID/:sessionId/search\"\n                          exact\n                          render={() => search}\n                        />\n                      </Switch>\n                    )}\n                  />\n                )}\n              />\n            </main>\n            <AppFooter />\n          </>\n        )}\n      </UserContextConsumer>\n    </>\n  );\n};\n\nexport default AppTemplate;\n"]},"metadata":{},"sourceType":"module"}