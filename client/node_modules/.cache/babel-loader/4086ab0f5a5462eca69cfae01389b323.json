{"ast":null,"code":"var _jsxFileName = \"/Users/lauraschultz/Documents/projects/yelp-restaurant-chooser/client/src/UserDataContext.tsx\";\nimport React, { useEffect, useState } from \"react\";\nimport { matchPath, useHistory, useLocation } from \"react-router-dom\";\nimport socket from \"./socket\";\nexport const UserContext = React.createContext({});\nconst {\n  Provider,\n  Consumer\n} = UserContext;\nexport const UserContextProvider = ({\n  children\n}) => {\n  let [sessionId, setSessionId] = useState(\"\");\n  let [userId, setUserId] = useState();\n  let [userState, setUserState] = useState(\"\");\n  let [location, setLocation] = useState(\"\");\n  let [previousVotes, setPreviousVotes] = useState({});\n  let [creatorName, setCreatorName] = useState();\n  let history = useHistory();\n  let appLoc = useLocation();\n  useEffect(() => {\n    console.log(`useeffect`);\n    const sUserId = localStorage.getItem(\"chewUserId\");\n\n    if (sUserId) {\n      setUserId(sUserId);\n    }\n  }, []);\n  useEffect(() => {\n    if (userId) {\n      console.log(`setting localStorage`);\n      localStorage.setItem(\"chewUserId\", userId);\n    }\n  }, [userId]);\n  useEffect(() => {\n    console.log(`location useEffect`);\n    const match = matchPath(appLoc.pathname, {\n      path: \"/ID/:sessionId\"\n    });\n\n    if (match) {\n      setSessionId(match.params.sessionId);\n    }\n  }, [location, appLoc.pathname]);\n\n  let createSession = (e, userName, loc) => {\n    e.preventDefault();\n    setLocation(loc);\n    socket.newSession({\n      userName,\n      location: loc,\n      userId\n    }, response => {\n      console.log(`emitting newSession. data is ${userName} ${loc} ${userId}`);\n      setSessionId(response.sessionId || \"\");\n      setCreatorName(userName);\n      setUserId(response.userId);\n      setUserState(\"canVote\");\n      history.push(`/ID/${response.sessionId}`); // history.\n\n      window.history.replaceState({\n        fromLogin: true\n      }, \"\"); // console.log(`window.history.state: ${JSON.stringify(window.history.state)}`)\n    }); // history.push(\"/home\");\n    // setSessionId(sessId)\n  };\n\n  return /*#__PURE__*/React.createElement(Provider, {\n    value: {\n      sessionId,\n      setSessionId,\n      userId,\n      setUserId,\n      userState,\n      setUserState,\n      createSession,\n      location,\n      setLocation,\n      creatorName,\n      setCreatorName,\n      previousVotes,\n      setPreviousVotes\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 64,\n      columnNumber: 5\n    }\n  }, children);\n};\nexport { Consumer as UserContextConsumer };","map":{"version":3,"sources":["/Users/lauraschultz/Documents/projects/yelp-restaurant-chooser/client/src/UserDataContext.tsx"],"names":["React","useEffect","useState","matchPath","useHistory","useLocation","socket","UserContext","createContext","Provider","Consumer","UserContextProvider","children","sessionId","setSessionId","userId","setUserId","userState","setUserState","location","setLocation","previousVotes","setPreviousVotes","creatorName","setCreatorName","history","appLoc","console","log","sUserId","localStorage","getItem","setItem","match","pathname","path","params","createSession","e","userName","loc","preventDefault","newSession","response","push","window","replaceState","fromLogin","UserContextConsumer"],"mappings":"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","sourcesContent":["import React, { FormEvent, useEffect, useState } from \"react\";\nimport { matchPath, useHistory, useLocation } from \"react-router-dom\";\nimport socket from \"./socket\";\n\nexport const UserContext = React.createContext<any>({});\nconst { Provider, Consumer } = UserContext;\n\nexport const UserContextProvider: React.FC = ({ children }) => {\n  let [sessionId, setSessionId] = useState(\"\");\n  let [userId, setUserId] = useState<string>();\n  let [userState, setUserState] = useState(\"\");\n  let [location, setLocation] = useState(\"\");\n  let [previousVotes, setPreviousVotes] = useState<{\n    [restaurantId: string]: number;\n  }>({});\n  let [creatorName, setCreatorName] = useState<string>();\n  let history = useHistory();\n\n  let appLoc = useLocation();\n\n  useEffect(() => {\n    console.log(`useeffect`);\n    const sUserId = localStorage.getItem(\"chewUserId\");\n    if (sUserId) {\n      setUserId(sUserId);\n    }\n  }, []);\n\n  useEffect(() => {\n    if (userId) {\n      console.log(`setting localStorage`);\n      localStorage.setItem(\"chewUserId\", userId);\n    }\n  }, [userId]);\n\n  useEffect(() => {\n    console.log(`location useEffect`);\n    const match = matchPath<{ sessionId: string }>(appLoc.pathname, {\n      path: \"/ID/:sessionId\",\n    });\n    if (match) {\n      setSessionId(match.params.sessionId);\n    }\n  }, [location, appLoc.pathname]);\n\n  let createSession = (e: FormEvent, userName: string, loc: string) => {\n    e.preventDefault();\n    setLocation(loc);\n    socket.newSession({ userName, location: loc, userId }, (response) => {\n      console.log(`emitting newSession. data is ${userName} ${loc} ${userId}`);\n      setSessionId(response.sessionId || \"\");\n      setCreatorName(userName);\n      setUserId(response.userId);\n      setUserState(\"canVote\");\n      history.push(`/ID/${response.sessionId}`);\n      // history.\n      window.history.replaceState({ fromLogin: true }, \"\");\n      // console.log(`window.history.state: ${JSON.stringify(window.history.state)}`)\n    });\n    // history.push(\"/home\");\n    // setSessionId(sessId)\n  };\n  return (\n    <Provider\n      value={{\n        sessionId,\n        setSessionId,\n        userId,\n        setUserId,\n        userState,\n        setUserState,\n        createSession,\n        location,\n        setLocation,\n        creatorName,\n        setCreatorName,\n        previousVotes,\n        setPreviousVotes,\n      }}\n    >\n      {children}\n    </Provider>\n  );\n};\n\nexport { Consumer as UserContextConsumer };\n"]},"metadata":{},"sourceType":"module"}