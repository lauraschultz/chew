{"ast":null,"code":"import _slicedToArray from\"/Users/lauraschultz/Documents/projects/yelp-restaurant-chooser/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import _defineProperty from\"/Users/lauraschultz/Documents/projects/yelp-restaurant-chooser/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";import _objectSpread from\"/Users/lauraschultz/Documents/projects/yelp-restaurant-chooser/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import React,{useState,useContext,useEffect,useCallback}from\"react\";import Vote from\"./Vote\";import{FontAwesomeIcon}from\"@fortawesome/react-fontawesome\";import{faCircleNotch,faInfoCircle,faSearch}from\"@fortawesome/free-solid-svg-icons\";import DisplayItem from\"./DisplayItem\";import socket from\"./socket\";import Filters from\"./Filters\";import AddRestaurantButton from\"./AddRestaurantButton\";import{UserContext}from\"./UserDataContext\";var DisplaySearchResults=function DisplaySearchResults(_ref){var businesses=_ref.businesses,voteOnRestaurant=_ref.voteOnRestaurant,isAdded=_ref.isAdded;var _useContext=useContext(UserContext),sessionId=_useContext.sessionId,userId=_useContext.userId,userState=_useContext.userState,previousVotes=_useContext.previousVotes,setPreviousVotes=_useContext.setPreviousVotes;return/*#__PURE__*/React.createElement(\"ul\",{className:\"divide-y divide-theme-extra-light-gray\"},businesses.map(function(b){return/*#__PURE__*/React.createElement(\"li\",{key:b.id},/*#__PURE__*/React.createElement(DisplayItem,{restaurant:{business:b,votes:[]},addRestaurant:/*#__PURE__*/React.createElement(AddRestaurantButton,{isRestaurantsAdded:isAdded[b.id],userState:userState,sessionId:sessionId,userId:userId,businessId:b.id}),vote:isAdded[b.id]?/*#__PURE__*/React.createElement(Vote,{currentVote:previousVotes[b.id],addVote:function addVote(v){voteOnRestaurant(b.id,v);setPreviousVotes(function(old){return _objectSpread(_objectSpread({},old),{},_defineProperty({},b.id,v));});}}):null}));}));};var Search=function Search(_ref2){var sessionId=_ref2.sessionId,location=_ref2.location,creatorName=_ref2.creatorName,voteOnRestaurant=_ref2.voteOnRestaurant,isAdded=_ref2.isAdded,searchFormState=_ref2.searchFormState,updateSearchFormState=_ref2.updateSearchFormState;var _useState=useState(searchFormState.search||\"\"),_useState2=_slicedToArray(_useState,2),searchTerm=_useState2[0],setSearchTerm=_useState2[1];var _useState3=useState(searchFormState.results||new Array()),_useState4=_slicedToArray(_useState3,2),businesses=_useState4[0],setBusinesses=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),loadingSearch=_useState6[0],setLoadingSearch=_useState6[1];var _useState7=useState(),_useState8=_slicedToArray(_useState7,2),filterResults=_useState8[0],setFilterResults=_useState8[1];var updateFilter=useCallback(function(r){console.log(\"filter sent: \".concat(JSON.stringify(r)));setFilterResults(r);},[setFilterResults]);useEffect(function(){updateSearchFormState({search:searchTerm,results:businesses});},[searchTerm,businesses,updateSearchFormState]);return/*#__PURE__*/React.createElement(\"div\",{className:\"max-w-md w-full mx-auto\"},/*#__PURE__*/React.createElement(\"h2\",{className:\"max-w-md mx-auto text-2xl px-1 text-theme-dark-gray font-display leading-none mb-1\"},\"Search\"),/*#__PURE__*/React.createElement(\"hr\",{className:\"border-theme-extra-light-gray\"}),/*#__PURE__*/React.createElement(\"form\",{className:\"p-2 w-full\",onSubmit:function onSubmit(e){e.preventDefault();setLoadingSearch(true);setBusinesses([]);socket.search(sessionId,searchTerm,(filterResults===null||filterResults===void 0?void 0:filterResults.openHours)||\"\",(filterResults===null||filterResults===void 0?void 0:filterResults.priceRange)||\"\",(filterResults===null||filterResults===void 0?void 0:filterResults.services)||\"\").then(function(b){setBusinesses(b);setLoadingSearch(false);}).catch(function(e){return console.log(\"oopsies \".concat(e));});}},/*#__PURE__*/React.createElement(\"div\",{className:\"text-theme-light-gray italic -mt-1\"},creatorName,\" set the location to\",\" \",/*#__PURE__*/React.createElement(\"span\",{className:\"uppercase text-sm font-bold\"},location,/*#__PURE__*/React.createElement(\"button\",{type:\"button\",\"aria-label\":\"Search results will not be strictly within this area; it serves as a starting point.\",\"data-balloon-pos\":\"down\",\"data-balloon-length\":\"medium\"},/*#__PURE__*/React.createElement(FontAwesomeIcon,{icon:faInfoCircle,className:\"ml-1\"})))),/*#__PURE__*/React.createElement(\"input\",{className:\"rounded py-1 px-2 shadow m-1\",type:\"text\",value:searchTerm,onChange:function onChange(e){return setSearchTerm(e.target.value);}}),/*#__PURE__*/React.createElement(\"button\",{className:\"shadow py-1 px-2 m-1 text-white bg-theme-blue rounded-full\",type:\"submit\"},/*#__PURE__*/React.createElement(FontAwesomeIcon,{\"aria-label\":\"search\",icon:faSearch})),/*#__PURE__*/React.createElement(Filters,{update:updateFilter,updateSearchFormState:updateSearchFormState,searchFormFilterState:searchFormState.filter})),loadingSearch&&/*#__PURE__*/React.createElement(FontAwesomeIcon,{icon:faCircleNotch,size:\"5x\",className:\"animate-spin text-theme-yellow mx-auto my-4 block\"}),/*#__PURE__*/React.createElement(DisplaySearchResults,{businesses:businesses,voteOnRestaurant:voteOnRestaurant,isAdded:isAdded}));};export default Search;","map":{"version":3,"sources":["/Users/lauraschultz/Documents/projects/yelp-restaurant-chooser/client/src/Search.tsx"],"names":["React","useState","useContext","useEffect","useCallback","Vote","FontAwesomeIcon","faCircleNotch","faInfoCircle","faSearch","DisplayItem","socket","Filters","AddRestaurantButton","UserContext","DisplaySearchResults","businesses","voteOnRestaurant","isAdded","sessionId","userId","userState","previousVotes","setPreviousVotes","map","b","id","business","votes","v","old","Search","location","creatorName","searchFormState","updateSearchFormState","search","searchTerm","setSearchTerm","results","Array","setBusinesses","loadingSearch","setLoadingSearch","filterResults","setFilterResults","updateFilter","r","console","log","JSON","stringify","e","preventDefault","openHours","priceRange","services","then","catch","target","value","filter"],"mappings":"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","sourcesContent":["import React, { useState, FormEvent, useContext, useEffect, useCallback } from \"react\";\nimport { Business } from \"../../shared/types\";\nimport Vote from \"./Vote\";\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\";\nimport {\n  faCircleNotch,\n  faInfoCircle,\n  faSearch,\n} from \"@fortawesome/free-solid-svg-icons\";\nimport DisplayItem from \"./DisplayItem\";\nimport socket from \"./socket\";\nimport Filters from \"./Filters\";\nimport AddRestaurantButton from \"./AddRestaurantButton\";\nimport { UserContext } from \"./UserDataContext\";\nimport { SearchFormState } from \"./Templates/AppTemplate\";\n\nconst DisplaySearchResults: React.FC<{\n  businesses: Business[];\n  voteOnRestaurant: Function;\n  isAdded: { [id: string]: boolean };\n}> = ({ businesses, voteOnRestaurant, isAdded }) => {\n  let {\n    sessionId,\n    userId,\n    userState,\n    previousVotes,\n    setPreviousVotes,\n  } = useContext(UserContext);\n  return (\n    <ul className=\"divide-y divide-theme-extra-light-gray\">\n      {businesses.map((b) => (\n        <li key={b.id}>\n          <DisplayItem\n            restaurant={{ business: b, votes: [] }}\n            addRestaurant={\n              <AddRestaurantButton\n                isRestaurantsAdded={isAdded[b.id]}\n                userState={userState}\n                sessionId={sessionId}\n                userId={userId}\n                businessId={b.id}\n              />\n            }\n            vote={\n              isAdded[b.id] ? (\n                <Vote\n                  currentVote={previousVotes[b.id]}\n                  addVote={(v: number) => {\n                    voteOnRestaurant(b.id, v);\n                    setPreviousVotes(\n                      (old: { [restaurantId: string]: number }) => ({\n                        ...old,\n                        [b.id]: v,\n                      })\n                    );\n                  }}\n                />\n              ) : null\n            }\n          />\n        </li>\n      ))}\n    </ul>\n  );\n};\n\nexport type FilterResults = {\n  openHours: \"any\" | \"today\" | \"now\";\n  priceRange: string;\n  services: string;\n};\n\nconst Search: React.FC<{\n  sessionId: string;\n  location: string;\n  creatorName: string;\n  voteOnRestaurant: Function;\n  isAdded: { [id: string]: boolean };\n  searchFormState: Partial<SearchFormState>;\n  updateSearchFormState: (s: Partial<SearchFormState>) => void\n}> = ({\n  sessionId,\n  location,\n  creatorName,\n  voteOnRestaurant,\n  isAdded,\n  searchFormState,\n  updateSearchFormState\n}) => {\n  let [searchTerm, setSearchTerm] = useState(searchFormState.search || \"\");\n  let [businesses, setBusinesses] = useState(searchFormState.results || new Array<Business>());\n  let [loadingSearch, setLoadingSearch] = useState(false);\n  let [filterResults, setFilterResults] = useState<FilterResults>();\n  const updateFilter = useCallback((r: FilterResults) => {\n    console.log(`filter sent: ${JSON.stringify(r)}`);\n    setFilterResults(r);\n  }, [setFilterResults])\n\n  useEffect(() => {\n    updateSearchFormState({search: searchTerm, results:businesses})\n  }, [searchTerm, businesses, updateSearchFormState])\n\n\n  return (\n    <div className=\"max-w-md w-full mx-auto\">\n      <h2 className=\"max-w-md mx-auto text-2xl px-1 text-theme-dark-gray font-display leading-none mb-1\">\n        Search\n      </h2>\n      <hr className=\"border-theme-extra-light-gray\" />\n      <form\n        className=\"p-2 w-full\"\n        onSubmit={(e: FormEvent) => {\n          e.preventDefault();\n          setLoadingSearch(true);\n          setBusinesses([]);\n          socket\n            .search(\n              sessionId,\n              searchTerm,\n              filterResults?.openHours || \"\",\n              filterResults?.priceRange || \"\",\n              filterResults?.services || \"\"\n            )\n            .then((b: Business[]) => {\n              setBusinesses(b);\n              setLoadingSearch(false);\n            })\n            .catch((e) => console.log(`oopsies ${e}`));\n        }}\n      >\n        <div className=\"text-theme-light-gray italic -mt-1\">\n          {creatorName} set the location to{\" \"}\n          <span className=\"uppercase text-sm font-bold\">\n            {location}\n            <button\n              type=\"button\"\n              aria-label=\"Search results will not be strictly within this area; it serves as a starting point.\"\n              data-balloon-pos=\"down\"\n              data-balloon-length=\"medium\"\n            >\n              <FontAwesomeIcon icon={faInfoCircle} className=\"ml-1\" />\n            </button>\n          </span>\n        </div>\n        <input\n          className=\"rounded py-1 px-2 shadow m-1\"\n          type=\"text\"\n          value={searchTerm}\n          onChange={(e) => setSearchTerm(e.target.value)}\n        ></input>\n        <button\n          className=\"shadow py-1 px-2 m-1 text-white bg-theme-blue rounded-full\"\n          type=\"submit\"\n        >\n          <FontAwesomeIcon aria-label=\"search\" icon={faSearch} />\n        </button>\n        <Filters\n          update={updateFilter}\n          updateSearchFormState={updateSearchFormState}\n          searchFormFilterState={searchFormState.filter}\n        />\n      </form>\n      {loadingSearch && (\n        <FontAwesomeIcon\n          icon={faCircleNotch}\n          size=\"5x\"\n          className=\"animate-spin text-theme-yellow mx-auto my-4 block\"\n        />\n      )}\n      <DisplaySearchResults\n        businesses={businesses}\n        voteOnRestaurant={voteOnRestaurant}\n        isAdded={isAdded}\n      />\n    </div>\n  );\n};\n\nexport default Search;\n"]},"metadata":{},"sourceType":"module"}