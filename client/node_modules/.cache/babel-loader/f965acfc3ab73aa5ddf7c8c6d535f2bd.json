{"ast":null,"code":"import _slicedToArray from\"/Users/lauraschultz/Documents/projects/yelp-restaurant-chooser/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useEffect,useState}from\"react\";import{matchPath,useHistory,useLocation}from\"react-router-dom\";import socket from\"./socket\";export var UserContext=React.createContext({});var Provider=UserContext.Provider,Consumer=UserContext.Consumer;export var UserContextProvider=function UserContextProvider(_ref){var children=_ref.children;var _useState=useState(\"\"),_useState2=_slicedToArray(_useState,2),sessionId=_useState2[0],setSessionId=_useState2[1];var _useState3=useState(),_useState4=_slicedToArray(_useState3,2),userId=_useState4[0],setUserId=_useState4[1];var _useState5=useState(\"\"),_useState6=_slicedToArray(_useState5,2),userState=_useState6[0],setUserState=_useState6[1];var _useState7=useState(\"\"),_useState8=_slicedToArray(_useState7,2),location=_useState8[0],setLocation=_useState8[1];var _useState9=useState({}),_useState10=_slicedToArray(_useState9,2),previousVotes=_useState10[0],setPreviousVotes=_useState10[1];var _useState11=useState(),_useState12=_slicedToArray(_useState11,2),creatorName=_useState12[0],setCreatorName=_useState12[1];var history=useHistory();var appLoc=useLocation();useEffect(function(){console.log(\"useeffect\");var sUserId=localStorage.getItem(\"chewUserId\");if(sUserId){setUserId(sUserId);}},[]);useEffect(function(){if(userId){console.log(\"setting localStorage\");localStorage.setItem(\"chewUserId\",userId);}},[userId]);useEffect(function(){console.log(\"location useEffect\");var match=matchPath(appLoc.pathname,{path:\"/ID/:sessionId\"});if(match){setSessionId(match.params.sessionId);}},[location,appLoc.pathname]);var createSession=function createSession(e,userName,loc){e.preventDefault();setLocation(loc);socket.newSession({userName:userName,location:loc,userId:userId},function(response){console.log(\"emitting newSession. data is \".concat(userName,\" \").concat(loc,\" \").concat(userId));setSessionId(response.sessionId||\"\");setCreatorName(userName);setUserId(response.userId);setUserState(\"canVote\");history.push(\"/ID/\".concat(response.sessionId));// history.\nwindow.history.replaceState({fromLogin:true},\"\");// console.log(`window.history.state: ${JSON.stringify(window.history.state)}`)\n});// history.push(\"/home\");\n// setSessionId(sessId)\n};return/*#__PURE__*/React.createElement(Provider,{value:{sessionId:sessionId,setSessionId:setSessionId,userId:userId,setUserId:setUserId,userState:userState,setUserState:setUserState,createSession:createSession,location:location,setLocation:setLocation,creatorName:creatorName,setCreatorName:setCreatorName,previousVotes:previousVotes,setPreviousVotes:setPreviousVotes}},children);};export{Consumer as UserContextConsumer};","map":{"version":3,"sources":["/Users/lauraschultz/Documents/projects/yelp-restaurant-chooser/client/src/UserDataContext.tsx"],"names":["React","useEffect","useState","matchPath","useHistory","useLocation","socket","UserContext","createContext","Provider","Consumer","UserContextProvider","children","sessionId","setSessionId","userId","setUserId","userState","setUserState","location","setLocation","previousVotes","setPreviousVotes","creatorName","setCreatorName","history","appLoc","console","log","sUserId","localStorage","getItem","setItem","match","pathname","path","params","createSession","e","userName","loc","preventDefault","newSession","response","push","window","replaceState","fromLogin","UserContextConsumer"],"mappings":"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","sourcesContent":["import React, { FormEvent, useEffect, useState } from \"react\";\nimport { matchPath, useHistory, useLocation } from \"react-router-dom\";\nimport socket from \"./socket\";\n\nexport const UserContext = React.createContext<any>({});\nconst { Provider, Consumer } = UserContext;\n\nexport const UserContextProvider: React.FC = ({ children }) => {\n  let [sessionId, setSessionId] = useState(\"\");\n  let [userId, setUserId] = useState<string>();\n  let [userState, setUserState] = useState(\"\");\n  let [location, setLocation] = useState(\"\");\n  let [previousVotes, setPreviousVotes] = useState<{\n    [restaurantId: string]: number;\n  }>({});\n  let [creatorName, setCreatorName] = useState<string>();\n  let history = useHistory();\n\n  let appLoc = useLocation();\n\n  useEffect(() => {\n    console.log(`useeffect`);\n    const sUserId = localStorage.getItem(\"chewUserId\");\n    if (sUserId) {\n      setUserId(sUserId);\n    }\n  }, []);\n\n  useEffect(() => {\n    if (userId) {\n      console.log(`setting localStorage`);\n      localStorage.setItem(\"chewUserId\", userId);\n    }\n  }, [userId]);\n\n  useEffect(() => {\n    console.log(`location useEffect`);\n    const match = matchPath<{ sessionId: string }>(appLoc.pathname, {\n      path: \"/ID/:sessionId\",\n    });\n    if (match) {\n      setSessionId(match.params.sessionId);\n    }\n  }, [location, appLoc.pathname]);\n\n  let createSession = (e: FormEvent, userName: string, loc: string) => {\n    e.preventDefault();\n    setLocation(loc);\n    socket.newSession({ userName, location: loc, userId }, (response) => {\n      console.log(`emitting newSession. data is ${userName} ${loc} ${userId}`);\n      setSessionId(response.sessionId || \"\");\n      setCreatorName(userName);\n      setUserId(response.userId);\n      setUserState(\"canVote\");\n      history.push(`/ID/${response.sessionId}`);\n      // history.\n      window.history.replaceState({ fromLogin: true }, \"\");\n      // console.log(`window.history.state: ${JSON.stringify(window.history.state)}`)\n    });\n    // history.push(\"/home\");\n    // setSessionId(sessId)\n  };\n  return (\n    <Provider\n      value={{\n        sessionId,\n        setSessionId,\n        userId,\n        setUserId,\n        userState,\n        setUserState,\n        createSession,\n        location,\n        setLocation,\n        creatorName,\n        setCreatorName,\n        previousVotes,\n        setPreviousVotes,\n      }}\n    >\n      {children}\n    </Provider>\n  );\n};\n\nexport { Consumer as UserContextConsumer };\n"]},"metadata":{},"sourceType":"module"}