{"ast":null,"code":"import _slicedToArray from\"/Users/lauraschultz/Documents/projects/yelp-restaurant-chooser/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useEffect,useRef,useState}from\"react\";import{googleCloudApiKey}from\"./config\";import{useClickOutsideListenerRef}from\"./useClickOutsideListenerRef\";var autoComplete;var loadScript=function loadScript(url,callback){var script=document.createElement(\"script\");script.type=\"text/javascript\";script.onload=callback;document.head.appendChild(script);script.src=url;};var PlacesAutocomplete=function PlacesAutocomplete(_ref){var searchTerm=_ref.searchTerm,selectPlace=_ref.selectPlace;var currentSearchTerm=useRef(\"\");var _useState=useState([]),_useState2=_slicedToArray(_useState,2),currentSearchResults=_useState2[0],setCurrentSearchResults=_useState2[1];var _useState3=useState(-1),_useState4=_slicedToArray(_useState3,2),hoveredIdx=_useState4[0],setHoveredIdx=_useState4[1];var scriptLoaded=useRef(false);var selectedText=useRef();var ref=useClickOutsideListenerRef(function(){return setCurrentSearchResults([]);});var handleScriptLoad=function handleScriptLoad(){autoComplete=new window.google.maps.places.AutocompleteService();scriptLoaded.current=true;};useEffect(function(){loadScript(\"https://maps.googleapis.com/maps/api/js?key=\".concat(googleCloudApiKey,\"&libraries=places\"),function(){return handleScriptLoad();});},[]);var keyPressEvent=function keyPressEvent(e){switch(e.key){case\"ArrowDown\":setHoveredIdx(function(val){return(val+1)%currentSearchResults.length;});break;case\"ArrowUp\":setHoveredIdx(function(val){return((val-1)%currentSearchResults.length+currentSearchResults.length)%currentSearchResults.length;});break;case\"Escape\":setCurrentSearchResults([]);setHoveredIdx(-1);break;case\"Enter\":if(hoveredIdx>-1&&currentSearchResults.length>0){e.preventDefault();select(currentSearchResults[hoveredIdx].description);setCurrentSearchResults([]);setHoveredIdx(-1);}}};useEffect(function(){window.addEventListener(\"keydown\",keyPressEvent);return function(){return window.removeEventListener(\"keydown\",keyPressEvent);};});// if(Math.abs(searchTerm.length - currentSearchTerm.length)<2){\n//     setCurrentSearchTerm(searchTerm);\n// }\nif(scriptLoaded&&searchTerm&&searchTerm!==currentSearchTerm.current// Math.abs(searchTerm.length - currentSearchTerm.current.length) > 1\n){currentSearchTerm.current=searchTerm;autoComplete.getPlacePredictions({input:searchTerm,types:[\"(regions)\"]},function(result,status){setCurrentSearchResults(result||[]);});}var select=function select(selectedItem){selectedText.current=selectedItem;selectPlace(selectedItem);// setCurrentSearchResults([])\n};if(selectedText.current===searchTerm){return/*#__PURE__*/React.createElement(\"ul\",{ref:ref});}var poweredByGoogle=require(\"./assets/powered_by_google_on_white.png\");return/*#__PURE__*/React.createElement(\"ul\",{ref:ref,className:\"absolute bg-white z-40 divide-y shadow text-sm rounded-b overflow:hidden\"},currentSearchResults.map(function(r,idx){return/*#__PURE__*/React.createElement(\"li\",{key:r.id,onMouseOver:function onMouseOver(e){return setHoveredIdx(idx);},className:\"px-2 py-1 cursor-pointer \"+(hoveredIdx===idx?\"bg-theme-blue-l-2 text-white\":\"\"),onClick:function onClick(){return select(r.description);}},r.description);}),currentSearchResults.length>0&&/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(\"img\",{src:poweredByGoogle,alt:\"powered by Google\",className:\"float-right px-2 py-1 w-38\"})));};export default PlacesAutocomplete;","map":{"version":3,"sources":["/Users/lauraschultz/Documents/projects/yelp-restaurant-chooser/client/src/PlacesAutocomplete.tsx"],"names":["React","useEffect","useRef","useState","googleCloudApiKey","useClickOutsideListenerRef","autoComplete","loadScript","url","callback","script","document","createElement","type","onload","head","appendChild","src","PlacesAutocomplete","searchTerm","selectPlace","currentSearchTerm","currentSearchResults","setCurrentSearchResults","hoveredIdx","setHoveredIdx","scriptLoaded","selectedText","ref","handleScriptLoad","window","google","maps","places","AutocompleteService","current","keyPressEvent","e","key","val","length","preventDefault","select","description","addEventListener","removeEventListener","getPlacePredictions","input","types","result","status","selectedItem","poweredByGoogle","require","map","r","idx","id"],"mappings":"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","sourcesContent":["import React, { useEffect, useRef, useState } from \"react\";\nimport { googleCloudApiKey } from \"./config\";\nimport { useClickOutsideListenerRef } from \"./useClickOutsideListenerRef\";\n\nlet autoComplete: google.maps.places.AutocompleteService;\n\nconst loadScript = (\n  url: string,\n  callback: (this: GlobalEventHandlers, ev: Event) => any\n) => {\n  let script = document.createElement(\"script\");\n  script.type = \"text/javascript\";\n  script.onload = callback;\n  document.head.appendChild(script);\n  script.src = url;\n};\n\nconst PlacesAutocomplete: React.FC<{\n  searchTerm: string;\n  selectPlace: (pl: string) => void;\n}> = ({ searchTerm, selectPlace }) => {\n  let currentSearchTerm = useRef(\"\");\n  let [currentSearchResults, setCurrentSearchResults] = useState<\n    google.maps.places.AutocompletePrediction[]\n  >([]);\n  let [hoveredIdx, setHoveredIdx] = useState(-1);\n  let scriptLoaded = useRef(false);\n  let selectedText = useRef<string>();\n  const ref = useClickOutsideListenerRef(() => setCurrentSearchResults([]));\n\n  const handleScriptLoad = () => {\n    autoComplete = new window.google.maps.places.AutocompleteService();\n    scriptLoaded.current = true;\n  };\n\n  useEffect(() => {\n    loadScript(\n      `https://maps.googleapis.com/maps/api/js?key=${googleCloudApiKey}&libraries=places`,\n      () => handleScriptLoad()\n    );\n  }, []);\n\n  const keyPressEvent = (e: KeyboardEvent) => {\n    switch (e.key) {\n      case \"ArrowDown\":\n        setHoveredIdx((val) => (val + 1) % currentSearchResults.length);\n        break;\n      case \"ArrowUp\":\n        setHoveredIdx(\n          (val) =>\n            (((val - 1) % currentSearchResults.length) +\n              currentSearchResults.length) %\n            currentSearchResults.length\n        );\n        break;\n      case \"Escape\":\n        setCurrentSearchResults([]);\n        setHoveredIdx(-1);\n        break;\n      case \"Enter\":\n        if (hoveredIdx > -1 && currentSearchResults.length > 0) {\n          e.preventDefault();\n          select(currentSearchResults[hoveredIdx].description);\n        setCurrentSearchResults([]);\n        setHoveredIdx(-1);\n        }\n        \n\n    }\n  };\n  useEffect(() => {\n    window.addEventListener(\"keydown\", keyPressEvent);\n\n    return () => window.removeEventListener(\"keydown\", keyPressEvent);\n  });\n\n  // if(Math.abs(searchTerm.length - currentSearchTerm.length)<2){\n  //     setCurrentSearchTerm(searchTerm);\n  // }\n\n  if (\n    scriptLoaded &&\n    searchTerm &&\n    searchTerm !== currentSearchTerm.current\n    // Math.abs(searchTerm.length - currentSearchTerm.current.length) > 1\n  ) {\n    currentSearchTerm.current = searchTerm;\n    autoComplete.getPlacePredictions(\n      { input: searchTerm, types: [\"(regions)\"] },\n      (result, status) => {\n        setCurrentSearchResults(result || []);\n      }\n    );\n  }\n\n  const select = (selectedItem: string) => {\n    selectedText.current = selectedItem;\n    selectPlace(selectedItem);\n    // setCurrentSearchResults([])\n  };\n\n  if (selectedText.current === searchTerm) {\n    return <ul ref={ref} />;\n  }\n\n  const poweredByGoogle = require(\"./assets/powered_by_google_on_white.png\");\n  return (\n    <ul\n      ref={ref}\n      className=\"absolute bg-white z-40 divide-y shadow text-sm rounded-b overflow:hidden\"\n    >\n      {currentSearchResults.map((r, idx) => (\n        <li\n          key={r.id}\n          onMouseOver={(e) => setHoveredIdx(idx)}\n          className={\n            \"px-2 py-1 cursor-pointer \" +\n            (hoveredIdx === idx ? \"bg-theme-blue-l-2 text-white\" : \"\")\n          }\n          onClick={() => select(r.description)}\n        >\n          {r.description}\n        </li>\n      ))}\n      {currentSearchResults.length > 0 && (\n        <div>\n        <img src={poweredByGoogle} alt=\"powered by Google\" className=\"float-right px-2 py-1 w-38\" />\n        </div>\n      )}\n    </ul>\n  );\n};\n\nexport default PlacesAutocomplete;\n"]},"metadata":{},"sourceType":"module"}