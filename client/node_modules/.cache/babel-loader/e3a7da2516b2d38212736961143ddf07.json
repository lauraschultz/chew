{"ast":null,"code":"var _jsxFileName = \"/Users/lauraschultz/Documents/projects/yelp-restaurant-chooser/client/src/Templates/AppTemplate.tsx\";\nimport { faBinoculars, faCircleNotch, faDoorOpen, faSearch, faUtensils } from \"@fortawesome/free-solid-svg-icons\";\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\";\nimport React, { useCallback, useContext, useEffect, useState } from \"react\";\nimport Media from \"react-media\";\nimport { Link, NavLink, Redirect, Route, Switch, useHistory } from \"react-router-dom\";\nimport Logo from \"../assets/chew_logo.svg\";\nimport Display from \"../Display\";\nimport AppFooter from \"../AppFooter\";\nimport ModalContainer from \"../ModalContainer\";\nimport Search from \"../Search\";\nimport ShareSessionModal from \"../ShareSessionModal\";\nimport socket from \"../socket\";\nimport Toast from \"../Toast\";\nimport { UserContext, UserContextConsumer } from \"../UserDataContext\";\nimport { UserNameModal } from \"../UserNameModal\";\n\nconst AppTemplate = () => {\n  let [addedRestaurants, setAddedRestaurants] = useState({});\n  let {\n    sessionId,\n    setSessionId,\n    userId,\n    setUserId,\n    setUserState,\n    location,\n    setLocation,\n    creatorName,\n    setCreatorName,\n    setPreviousVotes\n  } = useContext(UserContext);\n  let [isAdded, setIsAdded] = useState({});\n  let [loaded, setLoaded] = useState(false);\n  let [showVotingToast, setShowVotingToast] = useState(false);\n  let [showShareSessionModal, setShowShareSessionModal] = useState(false);\n  let [searchFormState, setSearchFormState] = useState({});\n  let history = useHistory();\n  useEffect(() => {\n    socket.subscribeToRestaurantAdded(newRestaurant => {\n      console.log(\"recieving an added restaurant.\");\n      setAddedRestaurants(r => ({ ...r,\n        [newRestaurant.business.id]: newRestaurant\n      }));\n    });\n    socket.subscribeToVoteAdded(params => {\n      setAddedRestaurants(r => ({ ...r,\n        [params.restaurantId]: { ...r[params.restaurantId],\n          votes: params.votes\n        }\n      }));\n    });\n    return () => {\n      socket.unSubscribeToRestaurantAdded();\n      socket.unSubscribeToVoteAdded();\n    };\n  }, []);\n\n  const voteOnRestaurant = (restaurantId, voteNum) => socket.addVote(sessionId, userId, restaurantId, voteNum);\n\n  const updateSearchFormState = useCallback(s => setSearchFormState(old => ({ ...old,\n    ...s\n  })), [setSearchFormState]);\n  let search = /*#__PURE__*/React.createElement(\"div\", {\n    className: \"flex-1 pt-4\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 105,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(Search, {\n    voteOnRestaurant: voteOnRestaurant,\n    isAdded: isAdded,\n    sessionId: sessionId,\n    location: location,\n    creatorName: creatorName,\n    searchFormState: searchFormState,\n    updateSearchFormState: updateSearchFormState,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 106,\n      columnNumber: 7\n    }\n  }));\n  let display = /*#__PURE__*/React.createElement(\"div\", {\n    className: \"flex-1 pt-4\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 119,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(Display, {\n    voteOnRestaurant: voteOnRestaurant,\n    addedRestaurants: addedRestaurants,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 120,\n      columnNumber: 7\n    }\n  }));\n  useEffect(() => {\n    const newIsAdded = {};\n    Object.keys(addedRestaurants).forEach(restId => newIsAdded[restId] = true);\n    setIsAdded(newIsAdded);\n  }, [addedRestaurants]);\n  useEffect(() => {\n    var _window$history, _window$history$state;\n\n    if ((_window$history = window.history) === null || _window$history === void 0 ? void 0 : (_window$history$state = _window$history.state) === null || _window$history$state === void 0 ? void 0 : _window$history$state.fromLogin) {\n      console.log(`REDIRECTED FROM LOGIN`);\n      setShowShareSessionModal(true);\n      setLoaded(true); // history.replace(history.location, {fromLogin:false})\n      // appLoc.state = {fromLogin:false}\n\n      window.history.replaceState({\n        fromLogin: false\n      }, \"\");\n    } else if (sessionId !== \"\") {\n      socket.tryJoinSession({\n        sessionId,\n        userId\n      }, response => {\n        console.log(`response from tryJoinSession is ${JSON.stringify(response)}`);\n\n        if (response.success) {\n          setShowVotingToast(false);\n          setSessionId(sessionId);\n          setUserId(response.userId);\n          setUserState(response.previouslyAuthenticated ? \"canVote\" : \"canView\");\n          setLocation(response.location);\n          setCreatorName(response.creatorName);\n          setPreviousVotes(response.previousVotes);\n          setAddedRestaurants(response.restaurants || {});\n          setLoaded(true);\n        } else {\n          history.push(\"/404\");\n          console.log(\"recieved failure from server\");\n        }\n      });\n    }\n  }, [sessionId, history, setCreatorName, setLocation, setPreviousVotes, setSessionId, setUserId, setUserState, userId]); //sessionId\n\n  return /*#__PURE__*/React.createElement(React.Fragment, null, showShareSessionModal && /*#__PURE__*/React.createElement(ModalContainer, {\n    shadow: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 173,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(ShareSessionModal, {\n    escape: () => setShowShareSessionModal(false),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 174,\n      columnNumber: 11\n    }\n  })), !loaded && /*#__PURE__*/React.createElement(ModalContainer, {\n    shadow: false,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 178,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(FontAwesomeIcon, {\n    icon: faCircleNotch,\n    size: \"5x\",\n    className: \"animate-spin text-theme-yellow block\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 179,\n      columnNumber: 11\n    }\n  })), /*#__PURE__*/React.createElement(Toast, {\n    show: showVotingToast,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 186,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"p-2 pt-1 md:p-3 md:pt-2 bg-gray-100 flex items-center rounded-md border\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 187,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(FontAwesomeIcon, {\n    icon: faBinoculars,\n    className: \"flex-initial text-gray-800 p-1 pb-0\",\n    size: \"3x\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 188,\n      columnNumber: 11\n    }\n  }), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"flex-1 pl-3\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 193,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"text-md font-bold border-b border-gray-400 px-1\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 194,\n      columnNumber: 13\n    }\n  }, \"Currently in view-only mode.\"), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"text-gray-700 leading-tight mt-1 px-1\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 197,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(\"span\", {\n    className: \"border-b-2 border-theme-blue hover:text-theme-blue cursor-pointer\",\n    onClick: () => {\n      setShowVotingToast(false);\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 198,\n      columnNumber: 15\n    }\n  }, \"Join the session\"), \" \", \"to add restaurants and vote\")))), /*#__PURE__*/React.createElement(UserContextConsumer, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 211,\n      columnNumber: 7\n    }\n  }, context => /*#__PURE__*/React.createElement(React.Fragment, null, loaded && context.userState !== \"canVote\" && !showVotingToast && /*#__PURE__*/React.createElement(ModalContainer, {\n    shadow: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 215,\n      columnNumber: 15\n    }\n  }, /*#__PURE__*/React.createElement(UserNameModal, {\n    escape: () => setShowVotingToast(true),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 216,\n      columnNumber: 17\n    }\n  })), /*#__PURE__*/React.createElement(\"header\", {\n    className: \"bg-theme-red text-white shadow \",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 219,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(\"nav\", {\n    className: \"flex justify-between p-1 lg:py-2 lg:px-4\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 220,\n      columnNumber: 15\n    }\n  }, /*#__PURE__*/React.createElement(Link, {\n    to: \"/getStarted\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 221,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(\"img\", {\n    className: \"text-white inline-block w-32 lg:w-38 flex-initial\",\n    src: Logo,\n    alt: \"chew logo\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 222,\n      columnNumber: 19\n    }\n  })), /*#__PURE__*/React.createElement(Link, {\n    to: \"/getStarted\",\n    className: \"inline-block flex-initial self-center text-sm\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 228,\n      columnNumber: 17\n    }\n  }, \"leave this group \", /*#__PURE__*/React.createElement(FontAwesomeIcon, {\n    icon: faDoorOpen,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 232,\n      columnNumber: 36\n    }\n  }))), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"md:hidden uppercase font-bold tracking-wide py-1 text-sm bg-theme-dark-red\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 235,\n      columnNumber: 15\n    }\n  }, /*#__PURE__*/React.createElement(NavLink, {\n    to: `/ID/${context.sessionId}`,\n    exact: true,\n    className: \"p-1 m-1\",\n    activeClassName: \"border-b-2 border-white\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 236,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(FontAwesomeIcon, {\n    icon: faUtensils,\n    size: \"sm\",\n    className: \"mr-2\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 242,\n      columnNumber: 19\n    }\n  }), \"view restaurants\"), /*#__PURE__*/React.createElement(NavLink, {\n    to: `/ID/${context.sessionId}/search`,\n    exact: true,\n    className: \"p-1 m-1\",\n    activeClassName: \"border-b-2 border-white\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 249,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(FontAwesomeIcon, {\n    icon: faSearch,\n    size: \"sm\",\n    className: \"mr-2\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 255,\n      columnNumber: 19\n    }\n  }), \"search\"))), /*#__PURE__*/React.createElement(\"main\", {\n    className: \"flex-grow\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 260,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(Media, {\n    query: \"(min-width: 768px)\",\n    render: () => /*#__PURE__*/React.createElement(Switch, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 265,\n        columnNumber: 19\n      }\n    }, /*#__PURE__*/React.createElement(Route, {\n      path: \"/ID/:sessionId\",\n      exact: true,\n      render: () => /*#__PURE__*/React.createElement(\"div\", {\n        className: \"flex justify-around px-1\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 270,\n          columnNumber: 25\n        }\n      }, display, \" \", search),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 266,\n        columnNumber: 21\n      }\n    }), /*#__PURE__*/React.createElement(Route, {\n      path: \"/\",\n      render: () => /*#__PURE__*/React.createElement(Redirect, {\n        to: `/ID/${context.sessionId}`,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 278,\n          columnNumber: 25\n        }\n      }),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 275,\n        columnNumber: 21\n      }\n    })),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 262,\n      columnNumber: 15\n    }\n  }), /*#__PURE__*/React.createElement(Media, {\n    query: \"(max-width: 767px)\",\n    render: () => /*#__PURE__*/React.createElement(Route, {\n      path: \"/ID/:sessionId\",\n      render: ({\n        location\n      }) =>\n      /*#__PURE__*/\n      // <div className=\"w-screen overflow-x-hidden\">\n      //   <div\n      //     className={\"whitespace-no-wrap transition-spacing \" + (location.pathname.search(\"search\") > -1 ? '-ml-screen': 'm-0')}\n      //     // style={\n      //     //   location.pathname.search(\"search\") > -1\n      //     //     ? { marginLeft: \"-100vw\" }\n      //     //     : { marginLeft: \"0\" }\n      //     // }\n      //   >\n      //     <div className=\"w-screen inline-block\">{display}</div>\n      //     <div className=\"w-screen inline-block\">{search}</div>\n      //   </div>\n      // </div>\n      React.createElement(Switch, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 306,\n          columnNumber: 23\n        }\n      }, /*#__PURE__*/React.createElement(Route, {\n        path: \"/ID/:sessionId\",\n        exact: true,\n        render: () => display,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 307,\n          columnNumber: 25\n        }\n      }), /*#__PURE__*/React.createElement(Route, {\n        path: \"/ID/:sessionId/search\",\n        exact: true,\n        render: () => search,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 312,\n          columnNumber: 25\n        }\n      })),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 289,\n        columnNumber: 19\n      }\n    }),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 286,\n      columnNumber: 15\n    }\n  })), /*#__PURE__*/React.createElement(AppFooter, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 323,\n      columnNumber: 13\n    }\n  }))));\n};\n\nexport default AppTemplate;","map":{"version":3,"sources":["/Users/lauraschultz/Documents/projects/yelp-restaurant-chooser/client/src/Templates/AppTemplate.tsx"],"names":["faBinoculars","faCircleNotch","faDoorOpen","faSearch","faUtensils","FontAwesomeIcon","React","useCallback","useContext","useEffect","useState","Media","Link","NavLink","Redirect","Route","Switch","useHistory","Display","AppFooter","ModalContainer","Search","ShareSessionModal","socket","Toast","UserContext","UserContextConsumer","UserNameModal","AppTemplate","addedRestaurants","setAddedRestaurants","sessionId","setSessionId","userId","setUserId","setUserState","location","setLocation","creatorName","setCreatorName","setPreviousVotes","isAdded","setIsAdded","loaded","setLoaded","showVotingToast","setShowVotingToast","showShareSessionModal","setShowShareSessionModal","searchFormState","setSearchFormState","history","subscribeToRestaurantAdded","newRestaurant","console","log","r","business","id","subscribeToVoteAdded","params","restaurantId","votes","unSubscribeToRestaurantAdded","unSubscribeToVoteAdded","voteOnRestaurant","voteNum","addVote","updateSearchFormState","s","old","search","display","newIsAdded","Object","keys","forEach","restId","window","state","fromLogin","replaceState","tryJoinSession","response","JSON","stringify","success","previouslyAuthenticated","previousVotes","restaurants","push","context","userState","Logo"],"mappings":"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","sourcesContent":["import {\n  faBinoculars,\n  faCircleNotch,\n  faDoorOpen,\n  faSearch,\n  faUtensils,\n} from \"@fortawesome/free-solid-svg-icons\";\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\";\nimport React, {\n  ReactFragment,\n  useCallback,\n  useContext,\n  useEffect,\n  useState,\n} from \"react\";\nimport Media from \"react-media\";\nimport {\n  Link,\n  NavLink,\n  Redirect,\n  Route,\n  Switch,\n  useHistory,\n} from \"react-router-dom\";\nimport { Business, BusinessWithVotes } from \"../../../shared/types\";\nimport Logo from \"../assets/chew_logo.svg\";\nimport Display from \"../Display\";\nimport AppFooter from \"../AppFooter\";\nimport ModalContainer from \"../ModalContainer\";\nimport Search from \"../Search\";\nimport ShareSessionModal from \"../ShareSessionModal\";\nimport socket from \"../socket\";\nimport Toast from \"../Toast\";\nimport { UserContext, UserContextConsumer } from \"../UserDataContext\";\nimport { UserNameModal } from \"../UserNameModal\";\nimport { FilterForm } from \"../YelpInterfaces\";\n\nexport interface SearchFormState {\n  search: string;\n  filter: FilterForm;\n  results: Business[];\n}\n\nconst AppTemplate: React.FC = () => {\n  let [addedRestaurants, setAddedRestaurants] = useState<{\n    [id: string]: BusinessWithVotes;\n  }>({});\n  let {\n    sessionId,\n    setSessionId,\n    userId,\n    setUserId,\n    setUserState,\n    location,\n    setLocation,\n    creatorName,\n    setCreatorName,\n    setPreviousVotes,\n  } = useContext(UserContext);\n  let [isAdded, setIsAdded] = useState<{ [id: string]: boolean }>({});\n  let [loaded, setLoaded] = useState(false);\n  let [showVotingToast, setShowVotingToast] = useState(false);\n  let [showShareSessionModal, setShowShareSessionModal] = useState(false);\n  let [searchFormState, setSearchFormState] = useState<\n    Partial<SearchFormState>\n  >({});\n  let history = useHistory();\n\n  useEffect(() => {\n    socket.subscribeToRestaurantAdded((newRestaurant: BusinessWithVotes) => {\n      console.log(\"recieving an added restaurant.\");\n      setAddedRestaurants((r) => ({\n        ...r,\n        [newRestaurant.business.id]: newRestaurant,\n      }));\n    });\n\n    socket.subscribeToVoteAdded(\n      (params: { restaurantId: string; votes: string[] }) => {\n        setAddedRestaurants((r) => ({\n          ...r,\n          [params.restaurantId]: {\n            ...r[params.restaurantId],\n            votes: params.votes,\n          },\n        }));\n      }\n    );\n    return () => {\n      socket.unSubscribeToRestaurantAdded();\n      socket.unSubscribeToVoteAdded();\n    };\n  }, []);\n\n  const voteOnRestaurant = (restaurantId: string, voteNum: number) =>\n    socket.addVote(sessionId, userId, restaurantId, voteNum);\n\n  const updateSearchFormState = useCallback(\n    (s: Partial<SearchFormState>) =>\n      setSearchFormState((old) => ({ ...old, ...s })),\n    [setSearchFormState]\n  );\n\n  let search: ReactFragment = (\n    <div className=\"flex-1 pt-4\">\n      <Search\n        voteOnRestaurant={voteOnRestaurant}\n        isAdded={isAdded}\n        sessionId={sessionId}\n        location={location}\n        creatorName={creatorName}\n        searchFormState={searchFormState}\n        updateSearchFormState={updateSearchFormState}\n      />\n    </div>\n  );\n\n  let display: ReactFragment = (\n    <div className=\"flex-1 pt-4\">\n      <Display\n        voteOnRestaurant={voteOnRestaurant}\n        addedRestaurants={addedRestaurants}\n      />\n    </div>\n  );\n\n  useEffect(() => {\n    const newIsAdded: { [id: string]: boolean } = {};\n    Object.keys(addedRestaurants).forEach(\n      (restId) => (newIsAdded[restId] = true)\n    );\n    setIsAdded(newIsAdded);\n  }, [addedRestaurants]);\n\n  useEffect(() => {\n    if (window.history?.state?.fromLogin) {\n      console.log(`REDIRECTED FROM LOGIN`);\n      setShowShareSessionModal(true);\n      setLoaded(true);\n\n      // history.replace(history.location, {fromLogin:false})\n      // appLoc.state = {fromLogin:false}\n\n      window.history.replaceState({ fromLogin: false }, \"\");\n    } else if (sessionId !== \"\") {\n      socket.tryJoinSession({ sessionId, userId }, (response) => {\n        console.log(\n          `response from tryJoinSession is ${JSON.stringify(response)}`\n        );\n        if (response.success) {\n          setShowVotingToast(false);\n          setSessionId(sessionId);\n          setUserId(response.userId);\n          setUserState(\n            response.previouslyAuthenticated ? \"canVote\" : \"canView\"\n          );\n          setLocation(response.location);\n          setCreatorName(response.creatorName);\n          setPreviousVotes(response.previousVotes);\n          setAddedRestaurants(response.restaurants || {});\n          setLoaded(true);\n        } else {\n          history.push(\"/404\");\n          console.log(\"recieved failure from server\");\n        }\n      });\n    }\n  }, [sessionId, history, setCreatorName, setLocation, setPreviousVotes, setSessionId, setUserId, setUserState, userId]); //sessionId\n\n  return (\n    <>\n      {showShareSessionModal && (\n        <ModalContainer shadow={true}>\n          <ShareSessionModal escape={() => setShowShareSessionModal(false)} />\n        </ModalContainer>\n      )}\n      {!loaded && (\n        <ModalContainer shadow={false}>\n          <FontAwesomeIcon\n            icon={faCircleNotch}\n            size=\"5x\"\n            className=\"animate-spin text-theme-yellow block\"\n          />\n        </ModalContainer>\n      )}\n      <Toast show={showVotingToast}>\n        <div className=\"p-2 pt-1 md:p-3 md:pt-2 bg-gray-100 flex items-center rounded-md border\">\n          <FontAwesomeIcon\n            icon={faBinoculars}\n            className=\"flex-initial text-gray-800 p-1 pb-0\"\n            size=\"3x\"\n          />\n          <div className=\"flex-1 pl-3\">\n            <div className=\"text-md font-bold border-b border-gray-400 px-1\">\n              Currently in view-only mode.\n            </div>\n            <div className=\"text-gray-700 leading-tight mt-1 px-1\">\n              <span\n                className=\"border-b-2 border-theme-blue hover:text-theme-blue cursor-pointer\"\n                onClick={() => {\n                  setShowVotingToast(false);\n                }}\n              >\n                Join the session\n              </span>{\" \"}\n              to add restaurants and vote\n            </div>\n          </div>\n        </div>\n      </Toast>\n      <UserContextConsumer>\n        {(context) => (\n          <>\n            {loaded && context.userState !== \"canVote\" && !showVotingToast && (\n              <ModalContainer shadow={true}>\n                <UserNameModal escape={() => setShowVotingToast(true)} />\n              </ModalContainer>\n            )}\n            <header className=\"bg-theme-red text-white shadow \">\n              <nav className=\"flex justify-between p-1 lg:py-2 lg:px-4\">\n                <Link to=\"/getStarted\">\n                  <img\n                    className=\"text-white inline-block w-32 lg:w-38 flex-initial\"\n                    src={Logo}\n                    alt=\"chew logo\"\n                  />\n                </Link>\n                <Link\n                  to=\"/getStarted\"\n                  className=\"inline-block flex-initial self-center text-sm\"\n                >\n                  leave this group <FontAwesomeIcon icon={faDoorOpen} />\n                </Link>\n              </nav>\n              <div className=\"md:hidden uppercase font-bold tracking-wide py-1 text-sm bg-theme-dark-red\">\n                <NavLink\n                  to={`/ID/${context.sessionId}`}\n                  exact={true}\n                  className=\"p-1 m-1\"\n                  activeClassName=\"border-b-2 border-white\"\n                >\n                  <FontAwesomeIcon\n                    icon={faUtensils}\n                    size=\"sm\"\n                    className=\"mr-2\"\n                  />\n                  view restaurants\n                </NavLink>\n                <NavLink\n                  to={`/ID/${context.sessionId}/search`}\n                  exact={true}\n                  className=\"p-1 m-1\"\n                  activeClassName=\"border-b-2 border-white\"\n                >\n                  <FontAwesomeIcon icon={faSearch} size=\"sm\" className=\"mr-2\" />\n                  search\n                </NavLink>\n              </div>\n            </header>\n            <main className=\"flex-grow\">\n              {/* LARGE DISPLAYS */}\n              <Media\n                query=\"(min-width: 768px)\"\n                render={() => (\n                  <Switch>\n                    <Route\n                      path=\"/ID/:sessionId\"\n                      exact\n                      render={() => (\n                        <div className=\"flex justify-around px-1\">\n                          {display} {search}\n                        </div>\n                      )}\n                    />\n                    <Route\n                      path=\"/\"\n                      render={() => (\n                        <Redirect to={`/ID/${context.sessionId}`} />\n                      )}\n                    />\n                  </Switch>\n                )}\n              />\n\n              {/* SMALL DISPLAYS */}\n              <Media\n                query=\"(max-width: 767px)\"\n                render={() => (\n                  <Route\n                    path=\"/ID/:sessionId\"\n                    render={({ location }) => (\n                      // <div className=\"w-screen overflow-x-hidden\">\n                      //   <div\n                      //     className={\"whitespace-no-wrap transition-spacing \" + (location.pathname.search(\"search\") > -1 ? '-ml-screen': 'm-0')}\n                      //     // style={\n                      //     //   location.pathname.search(\"search\") > -1\n                      //     //     ? { marginLeft: \"-100vw\" }\n                      //     //     : { marginLeft: \"0\" }\n                      //     // }\n                      //   >\n                      //     <div className=\"w-screen inline-block\">{display}</div>\n                      //     <div className=\"w-screen inline-block\">{search}</div>\n                      //   </div>\n                      // </div>\n\n                      <Switch>\n                        <Route\n                          path=\"/ID/:sessionId\"\n                          exact\n                          render={() => display}\n                        />\n                        <Route\n                          path=\"/ID/:sessionId/search\"\n                          exact\n                          render={() => search}\n                        />\n                      </Switch>\n                    )}\n                  />\n                )}\n              />\n            </main>\n            <AppFooter />\n          </>\n        )}\n      </UserContextConsumer>\n    </>\n  );\n};\n\nexport default AppTemplate;\n"]},"metadata":{},"sourceType":"module"}